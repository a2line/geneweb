<!DOCTYPE html>
<html lang="%lang;">
<head>
<meta charset="UTF-8">
<title>Arbre en éventail</title>
<link rel="stylesheet" href="%etc_prefix;css/all.min.css?version=6.4.0">
<link rel="stylesheet" href="%etc_prefix;css/fanchart.css?version=7.1">
<style title="fc-auto"></style>
</head>

%define;somebody_fanchart_info(xx,iii)
  "S%xx.anc_sosa.v;":{"fn":"%if(xx.public_name != "")%xx.public_name;%else;%xx.first_name;%end;","fnk":"%xx.first_name_key","sn":"%xx.surname","snk":"%xx.surname_key;","oc":"%xx.occ","dates":'%xx.dates;',"birth_place":"%xx.birth_place;","death_place":"%xx.death_place","death_age":"%if;xx.is_dead;%if;xx.computable_death_age;%xx.death_age;%end;%else;%if;xx.computable_age;%xx.age;%end;%end;","has_parents":%if(xx.has_parents)true%else;false%end;%nn;
  %if;(e.ba = "on" and xx.baptism_place != ""),"baptism_place":"%xx.baptism_place;"%end;
  %if;(e.bu = "on" and xx.burial_place != ""),"burial_place":"%xx.burial_place;"%end;
  %if;(xx.index!=iii and xx.is_male)
    %foreach;xx.family;
      %if;(family.index = xx.family.index)
        ,"marriage_date":"%family.date_s;","marriage_place":"%marriage_place;"
        ,"marriage_length":"%nn;
        %if;(not (are_separated or are_divorced))
          %if;(xx.death_date!="" and xx.spouse.death_date!="")
            %if;(xx.death_date.year<xx.spouse.death_date.year)%expr(xx.death_date.year-family.marriage_date.year)
            %else;%expr(xx.spouse.death_date.year-family.marriage_date.year)
            %end;
          %end;
        %else;%(TODO create a new %divorce_date.year; only%)
        %end;"
      %end;
    %end;
  %end;},
%end;
%define;somebody_fanchart_same(xx)
"S%xx.anc_sosa.v;":{"fn":"=","sn":"%xx.same","fnk":"%xx.first_name_key","snk":"%xx.surname_key;","oc":"","dates":"","has_parents":%if;(xx.has_parents)true%else;false%end;},
%end;

<body id="body">
<canvas id="pixel" width="1" height="1" style="display: none;"></canvas>
<div id="places-list"><ul id="places_list"></ul></div>
<div id="death-age">
<div><b>[*age]</b><ul>
<li id="DA0"><span class="arrow">▶</span><span class="DA0">■</span>  0-14</li>
<li id="DA1"><span class="arrow">▶</span><span class="DA1">■</span> 15-29</li>
<li id="DA2"><span class="arrow">▶</span><span class="DA2">■</span> 30-44</li>
<li id="DA3"><span class="arrow">▶</span><span class="DA3">■</span> 45-59</li>
<li id="DA4"><span class="arrow">▶</span><span class="DA4">■</span> 60-74</li>
<li id="DA5"><span class="arrow">▶</span><span class="DA5">■</span> 75-89</li>
<li id="DA6"><span class="arrow">▶</span><span class="DA6">■</span> 90-104</li>
<li id="DA7"><span class="arrow">▶</span><span class="DA7">■</span> 105+</li>
</ul></div>
<div><b>[*marriage/marriages]0</b><ul>
<li id="DAM0"><span class="arrow">▶</span><span class="DAM0">■</span>  0- 4</li>
<li id="DAM1"><span class="arrow">▶</span><span class="DAM1">■</span>  5-14</li>
<li id="DAM2"><span class="arrow">▶</span><span class="DAM2">■</span> 15-24</li>
<li id="DAM3"><span class="arrow">▶</span><span class="DAM3">■</span> 25-34</li>
<li id="DAM4"><span class="arrow">▶</span><span class="DAM4">■</span> 35-44</li>
<li id="DAM5"><span class="arrow">▶</span><span class="DAM5">■</span> 45-54</li>
<li id="DAM6"><span class="arrow">▶</span><span class="DAM6">■</span> 55-65</li>
<li id="DAM7"><span class="arrow">▶</span><span class="DAM7">■</span> 65+</li>
</ul></div>
</div>
%if;(e.pdf!="on")
  <div id="buttons" class="btn-group" role="group" aria-label="button group">
  <button id="b-home" class="button btn btn-lg" title="Accueil" tabindex="0"><i class="fa fa-house fa-fw"></i></button>
  <button id="b-refresh" class="button btn btn-lg" title="Ajuster à la fenêtre" tabindex="1"><i class="fa fa-arrow-rotate-right fa-fw"></i></button>
  <br>
  <button id="b-zoom-in" class="button btn btn-lg mt-1" title="Zoomer" tabindex="2"><i class="fa fa-magnifying-glass-plus fa-fw"></i></button>
  <button id="b-zoom-out" class="button btn btn-lg" title="Dézoomer" tabindex="3"><i class="fa fa-magnifying-glass-minus fa-fw"></i></button>
  <br>
  <button id="b-gen-add" class="button btn%if;(e.v >= 10) disabled%end;" title="Ajouter une génération" tabindex="4"><i class="fa fa-plus fa-fw"></i></button>
  <button id="b-gen-del" class="button btn%if;(e.v <= 1) disabled%end;" title="Supprimer une génération" tabindex="5"><i class="fa fa-minus fa-fw"></i></button>
    <br>
  <button id="b-implex" class="button btn btn-lg" title="%if;(e.implex="")Développer%else;Réduire%end; les implexes" tabindex="6"><i class="fa fa-comment-%if;(e.implex="")dots%else;slash%end; fa-fw"></i></button>
  <button id="b-places-hl" class="button btn btn-lg" title="Activer la mise en évidence des lieux" tabindex="7"><i class="fa fa-earth-americas fa-fw"></i></button>
    <br>
  <button id="b-places-colorise" class="button btn btn-lg" title="Activer la colorisation globale des lieux" tabindex="8"><i class="fa fa-paintbrush fa-fw"></i></button>
  <input type="checkbox" id="bi" title="N" tabindex="9"><label for="bi">N</label>
  <span id="bal"><input type="checkbox" id="ba" title="B"><label for="ba">B</label></span>
  <input type="checkbox" id="ma" title="M" tabindex="10"><label for="ma">M</label>
  <input type="checkbox" id="de" title="D"><label for="de">D</label>
  <span id="bul"><input type="checkbox" id="bu" title="S" tabindex="11"><label for="bu">S</label></span>
  <br>
  <button id="b-death-age" class="button btn btn-lg" title="Activer la colorisation de l'âge (individus/mariages)" tabindex="12"><i class="fa fa-cross fa-fw"></i></button>
  <button id="b-no-tool" class="button btn btn-lg" title="Désactiver les outils" tabindex="13"><i class="fa fa-power-off fa-fw"></i></button>
  <br>
  <button id="b-no-buttons" class="button" title="Masquer tous les boutons" tabindex="14"><i class="fa fa-minus fa-fw"></i></button>
  </div>
%end;
<svg id="fanchart" class="bi ba ma de bu%if;(e.mono = "on") mono%end;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>

</body>

<script>
var link_to_person = "%prefix;";
var link_to_fanchart = "%prefix;m=A&t=FC&%if;(e.mono != "")mono=%e.mono;&%end;%if;(e.implex != "")implex=%e.implex;&%end;";
var max_gen = %e.v;;
var tool = "%e.tool;";
var mono = "%e.mono;";
var implex = "%e.implex;";

var ancestor = {
%foreach;ancestor_level(e.v)
  %foreach;ancestor;
    %if;(ancestor.same = "")
      %apply;somebody_fanchart_info("ancestor", index)
    %else;
      %apply;somebody_fanchart_same("ancestor")
    %end;
  %end;
%end;
};
</script>
<script src="%etc_prefix;js/fanchart.js"></script>
</html>
