<!DOCTYPE html>
<html lang="%lang;">
<head>
  <!-- $Id: dag.txt, v7.xx 04/02/2022 14:45:14 ddr hg a2 $ -->
  <!-- Copyright (c) 1998-2022 INRIA -->
  <title>%nn;
    %if;(evar.slices = "on")[*display by slices/slice width/overlap/total width]0%nn;
    %else;%apply;capitalize(head_title)%end;
  </title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="%image_prefix;/favicon_gwd.png">
%include;css
</head>
<body%body_prop;>
%include;hed
%message_to_wizard;
%( TODO include;menubar %index, %foreach;family, do not work in this context %)
%let;prefix_a;%prefix_base_password&p=%evar.p;&n=%evar.n;%nn;
  %if;(evar.oc!="")&oc=%evar.oc;%end;%in; %(%access does not work %)
<div class="container-fluid">
%include;home
<h1 class="h3">
  %if;(evar.slices="on")
    [*display by slices/slice width/overlap/total width]0
  %else;
    %if;(evar.m="D")[*descendants tree]
    %elseif;(evar.m="A")[*ascendants tree]
    %else;[*relation/relations]0 ([shortest path])%end;
    %if;(evar.oi!="") [partial]%end;
    %if;(evar.dag="on") + [dag]%end;
  %end;
</h1>
%if;(evar.t="A" or evar.t="C")
  <h2 class="h4">
    %if;(evar.t = "A")[*male line/female line]0%nn;
    %elseif;(evar.t = "C")[*male line/female line]1%nn;
    %end;
  </h2>
%end;
%if;not cancel_links;
  <div class="d-flex justify-content-center">
    %include;buttons_dag
  </div><hr>
%end;
%if;(evar.m="A" or evar.m="D")
  %if;(evar.slices = "on")
    <form method="GET" action="%action;">
    <p>
    %hidden;
    %foreach;env_binding;
      %if;(env.key != "slices")
        <input type="hidden" name="%env.key;" value="%env.val.decoded;"%/>
      %end;
    %end;
    </p>
    <table>
    <tr align="%left;">
      <td align="%right;">
        <label>
        [*don't group the common branches together]
        <input type="checkbox" name="nogroup" value="on"%/>
        </label>
      </td>
    </tr>
    <tr align="%left;">
      <td align="%right;">
        <label>
        [*display by slices/slice width/overlap/total width]1
        <input name="dpos" size="5" value="78"%/>
        </label>
      </td>
    </tr>
    <tr align="%left;">
      <td align="%right;">
        <label>
        [*display by slices/slice width/overlap/total width]2
        <input name="overlap" size="5" value="10"%/>
        </label>
      </td>
    </tr>
    <tr align="%left;">
      <td align="%right;">
        <label>
        [*display by slices/slice width/overlap/total width]3
        (%dag.min_wid;-%dag.max_wid;)
        <input name="width" size="5" value="%nn;
          %if;(dag.max_wid <= 78)%dag.max_wid;
          %elseif;(dag.min_wid >= 78)%dag.min_wid;
          %else;78%end;"%/>
        </label>
      </td>
    </tr>
    </table>
    <p><input type="submit" value="Ok"%/></p>
    </form>
  %end;
%end;
%if;(evar.slices!="on")
  %if;(link_next!="" and not cancel_links)
    %include;buttons_rel
  %end;
  %if;(evar.notab = "on" or evar.pos2 != "")
    %let;dpos;%if;(evar.dpos != "")%evar.dpos;%else;78%end;%in;
    %let;pos1;%if;(evar.pos1 != "")%evar.pos1;%else;0%end;%in;
    %let;pos2;%if;(evar.pos2 != "")%evar.pos2;%else;%dpos;%end;%in;
    %let;overlap;%if;(evar.overlap != "")%evar.overlap;%else;10%end;%in;
    %if;(pos1 != 0 or pos2 < dag.ncol)
      <div style="text-align:right">
        %if;(pos1 = 0)&nbsp;%nn;
        %else;
          <a href="%prefix_base_password;%nn;
            %foreach;env_binding;%nn;
              %if;(env.key != "pos1" and env.key != "pos2")%env.key;=%env.val;;%end;%nn;
            %end;%nn;
            pos1=%expr(pos1 + overlap - dpos);%nn;
            pos2=%expr(pos1 + overlap);">&lt;&lt;</a>
        %end;%nl
        %if;(pos2 >= dag.ncol)&nbsp;%nn;
        %else;
          <a href="%prefix_base_password;%nn;
            %foreach;env_binding;%nn;
              %if;(env.key != "pos1" and env.key != "pos2")%env.key;=%env.val;;%end;%nn;
            %end;%nn;
            pos1=%expr(pos2 - overlap);%nn;
            pos2=%expr(pos2 - overlap + dpos);">&gt;&gt;</a>
        %end;%nl;
      </div>
    %end;
    <pre>
    %foreach;dag_line;
      %foreach;dag_line_pre;
        %foreach;dag_cell_pre;
          %dag_cell_pre;%nn;
        %end;%nl;
      %end;
    %end;
    </pre>
  %else;
    <div class="d-flex align-items-center align-content-center">
    <table id="dag" style="line-height:1rem;">
    %foreach;dag_line;
      <tr align="left">
      %foreach;dag_cell;
        <td class="align-top p-0"
          %if;(dag_cell.colspan>1) colspan="%dag_cell.colspan;"%end;
          style="line-height:%if;(dag_cell.item!="")1rem%nn;
                             %elseif;dag_cell.is_bar;0.85rem%nn;
                             %elseif;dag_cell.is_nothing;0.15rem%end;"%nn;
        %if;(evar.image!="off") valign="bottom"%end;
        align="%dag_cell.align;">
        %if;dag_cell.is_nothing;&nbsp;%nn;
        %elseif;dag_cell.is_bar;
          %if;(dag_cell.bar_link != "" and not cancel_links and evar.em!="R")
             %( added em!=R here condition because first button_rel is static and does the same %)
            <a href="%dag_cell.bar_link;%if;(evar.image!="")&image=%evar.image;%end;" title="[*tree]">│</a>%nn;
          %else;│%end;
        %elseif;(dag_cell.item != "")%dag_cell.item;
        %elseif;(dag_cell.text != "")
          %if;(plugin.v7 and line_nbr!=0 and dag_cell.index!="-1")
            %( TODO: add css class for hover, don't use list-group-item-action not done for that %)
            <div class="position-relative list-group-item-action">
              <a href="%prefix_no_pmod;i=%dag_cell.index;&m=D&t=TV&%foreach;env_binding;%nn;
                %if;(not (env.key="i" or env.key="p" or env.key="n" or env.key="oc" or
                          env.key="m" or env.key="t"))%env.key;=%env.val;&%end;%end;"
                class="stretched-link"
                title="[*navigation] on tree [with] this individual" style="line-height:1rem"></a>
          %end;
          <div%if;(dag_cell.txt!="") class="mt-1 mx-1"%end;>%dag_cell.text;</div>
          %if;(plugin.v7 and line_nbr!=0 and dag_cell.index!="-1")
            </div>
          %end;
        %else;
          %( TODO : trouver une condition pour un hr stylisé pour les conjoints %)
          %if;dag_cell.is_hr_left;
            <hr%if;(line_nbr=1) style="border-top: 1px dashed red;"%end; class="%left;"%/>%nn;
          %elseif;dag_cell.is_hr_right;
            <hr%if;(line_nbr=1) style="border-top: 1px dashed red;"%end; class="%right;">%nn;
          %else;
            <hr%if;(line_nbr=1) style="border-top: 1px dashed red;"%end; class="full"%/>%nn;
          %end;
        %end;
        </td>
      %end;
      </tr>
    %end;
    </table>
    </div>
  %end;
%end;
%include;trl
%include;copyr
</div>
%include;js
</body>
</html>
