const CheckData=(()=>{'use strict';const a=new WeakMap,b=new Set,c=requestAnimationFrame;let d=null,e='';const f={err:'.err',editContainer:'.edit-container',s2:'a.s2',button:'button:not([data-action])',inputField:'input, textarea',disabled:'disabled',validated:'validated',editing:'editing'},g=(a,b)=>(b||document).querySelector(a),h=(a,b)=>Array.from((b||document).querySelectorAll(a)),i=a=>{if(!a)return!1;const b=getComputedStyle(a);return'hidden'!==b.visibility&&'none'!==b.display},j=(a,b)=>{const c=document.createElement(a?'textarea':'input');return c.className='form-control',c.value=b,a||(c.type='text'),c},k=(b,c)=>{const d=document.createElement('div');d.className=f.editContainer.slice(1);const e=document.createElement('div');return e.className='original-content',e.innerHTML=b.innerHTML,d.appendChild(e),d.appendChild(c),a.set(d,{btn:b}),d},l=a=>{const b=a.target,c=b.closest(f.err);if(c?.classList.contains(f.disabled)&&!b.closest(f.s2))return void a.preventDefault();const d=b.closest(f.button);if(d?.closest(f.err))return a.preventDefault(),void m(d);const e=b.closest(f.s2);e?.closest(f.err)&&(a.preventDefault(),u(e,e.closest(f.err)))},n=a=>{const b=a.key;if('ArrowDown'!==b&&'ArrowUp'!==b)return;const c=document.activeElement?.closest(f.err);c&&!g(f.editContainer,c)&&(a.preventDefault(),t(c,'ArrowUp'===b))},m=b=>{const d=b.closest(f.err);if(d.classList.contains(f.editing))return;const e=d.dataset.ori||'',h=g(f.s2,d),i=h?.style.visibility==='hidden';h&&!h.dataset.origHidden&&(h.dataset.origHidden=i?'1':'0'),d.classList.add(f.editing);const l=j(e.length>115||e.includes('\n'),e),m=k(b,l);b.replaceWith(m),c(()=>{l.focus(),l.setSelectionRange(e.length,e.length),'TEXTAREA'===l.tagName&&window.autosize&&autosize(l)}),o(l,m,h,e,i)},o=(a,b,d,g,h)=>{const i={href:d?.href,title:d?.title||''};let j=!1;const k=()=>{if(!d)return;const b=a.value.trim(),f=b!==g&&''!==b;j||(d.dataset.origHref=i.href,d.dataset.origTitle=i.title,j=!0),c(()=>{if(f){const a=d.dataset.origHref||i.href;d.href=a.includes('&s2=')?a.replace(/(&s2=)[^&]*/,`$1${encodeURIComponent(b)}`):`${a}&s2=${encodeURIComponent(b)}`,d.className='s2 btn btn-warning',d.style.visibility='visible',d.title=e}else d.href=i.href,d.className='s2 btn btn-success',d.style.visibility=h?'hidden':'visible',d.title=i.title})},l=a=>{const c=a.key,e=b.closest(f.err);'Enter'===c?(a.preventDefault(),d?.style.visibility!=='hidden'&&(d.focus(),u(d,e))):'Escape'===c?(a.preventDefault(),p(b,d,h)):('ArrowDown'===c||'ArrowUp'===c)&&(a.preventDefault(),t(e,'ArrowUp'===c))},m=c=>{c.relatedTarget!==d&&setTimeout(()=>{document.activeElement!==a&&document.activeElement!==d&&p(b,d,h)},200)};a.addEventListener('input',k),a.addEventListener('keydown',l),a.addEventListener('blur',m)},p=(b,c,d)=>{const e=b?.closest(f.err);if(!e)return;e.classList.remove(f.editing);const g=a.get(b);if(g?.btn&&b.parentNode)try{b.replaceWith(g.btn.cloneNode(!0))}catch{}c&&!c.classList.contains('btn-info')&&(c.className='s2 btn btn-success',c.dataset.origHref&&(c.href=c.dataset.origHref,c.title=c.dataset.origTitle||''))},q=(a,b,c=4e3)=>{h('.ajax-notification').forEach(a=>a.remove());const d=document.createElement('div');d.className=`alert alert-${'success'===a?'success':'danger'} ajax-notification`,d.innerHTML=`<div class="d-flex align-items-center"><span class="flex-grow-1">${b}</span><button type="button" class="close ml-2">&times;</button></div>`;const e=()=>{d.classList.add('removing'),d.addEventListener('animationend',()=>d.remove(),{once:!0})},f=setTimeout(e,c);g('.close',d).onclick=()=>{clearTimeout(f),e()},document.body.appendChild(d)},r=(a,b,d)=>{const g=a?.closest(f.err);if(!g)return;g.classList.remove(f.editing);const h=b.originalButton;if(h&&b.parentNode)try{b.replaceWith(h.cloneNode(!0))}catch(a){console.debug('Container already removed')}c(()=>{d&&!d.classList.contains('btn-info')&&(d.classList.remove('btn-warning'),d.classList.add('btn-success'),d.dataset.origHref&&(d.href=d.dataset.origHref,d.title=d.dataset.origTitle||''))},16)},s=(a,b,d)=>{c(()=>{b.innerHTML='<i class="fa fa-spell-check"></i>',b.className='s2 btn btn-success',b.style.pointerEvents='none',b.style.visibility='visible';let c=g(f.editContainer,a);const e=g(f.button,a);if(c){const a=g(f.inputField,c);if(a&&d){const b=document.createElement('div');b.className='text-muted',b.textContent=d,a.replaceWith(b)}}else if(e&&d){c=document.createElement('div'),c.className=f.editContainer.slice(1);const a=document.createElement('div');a.className='original-content',a.innerHTML=e.innerHTML,c.appendChild(a);const b=document.createElement('div');b.className='text-muted',b.textContent=d,c.appendChild(b),e.replaceWith(c)}a.classList.add(f.disabled,f.validated),a.classList.remove(f.editing)})},t=(a,b=!1)=>{if(!a)return;if(!a.classList.contains(f.validated)){const c=g(f.editContainer,a);if(c){const d=g(f.s2,a);p(c,d,'1'===d?.dataset.origHidden)}}const d=h(f.err),e=d.indexOf(a),j=b?-1:1;let k;for(let a=e+j;b?a>=0:a<d.length;a+=j)if(!d[a].classList.contains(f.disabled)){k=d[a];break}if(!k)return;const l=g(f.s2,k),m=l?.classList.contains('btn-info');c(()=>{m&&i(l)?(l.focus(),l.scrollIntoView({behavior:'smooth',block:'center'})):(n=g(f.button,k))&&(n.click(),n.scrollIntoView({behavior:'smooth',block:'center'}));var n})},u=async(a,c)=>{if(!a||!c)return;const d=a.href;if(b.has(d))return;b.add(d);const e=a.innerHTML;a.innerHTML='<i class="fa fa-spinner fa-spin"></i>',a.className='s2 btn btn-info';let h=null;const i=g(f.editContainer,c);if(i){const a=g(f.inputField,i);a&&(h=a.value.trim())}if(!h){const b=new URLSearchParams(a.href.split('?')[1]);h=b.get('s2')}try{const b=await fetch(`${a.href}&ajax`,{method:'GET',headers:{Accept:'application/json','X-Requested-With':'XMLHttpRequest'}});if(!b.ok)throw new Error(`HTTP ${b.status}`);const d=await b.json();d.success?(q('success',`✓ ${d.message}`),s(c,a,d.after||h),setTimeout(()=>t(c),300)):(q('error',`✗ ${d.message}`),a.innerHTML='<i class="fa fa-exclamation-triangle"></i>',a.className='s2 btn btn-danger',a.title=d.message,setTimeout(()=>{a.innerHTML=e,a.className='s2 btn btn-warning'},2e3))}catch(c){console.error('AJAX error:',c),a.innerHTML=e,a.className='s2 btn btn-warning',window.open(a.href,'_blank')}finally{b.delete(d)}};return{init(){this.initToggles(),this.initMaxValidation(),this.preserveScroll(),d=g('#cd'),d&&(e=d.dataset.okTitle||'',d.addEventListener('click',l,{passive:!1}),d.addEventListener('keydown',n,{passive:!1}))},initToggles(){const a=(a,b)=>{const c=g(`[data-action="${a}"]`);c&&!c.dataset.init&&(c.dataset.init='1',c.addEventListener('click',d=>{d.preventDefault();const a=h(`[name^="${b}"]`),c=a.every(a=>a.checked);a.forEach(a=>a.checked=!c)}))};a('toggle-dicts','d_'),a('toggle-errors','e_');const b=g('[data-action="validate-submit"]');b&&!b.dataset.init&&(b.dataset.init='1',b.addEventListener('click',()=>{'function'==typeof showOverlay&&showOverlay()}))},initMaxValidation(){const a=g('input[name="max"]');if(!a)return;const b=a.getAttribute('max');b&&(a.type='number',a.min='1',a.addEventListener('input',a=>{const c=parseInt(a.target.value),d=parseInt(b);a.target.setCustomValidity(c>d?`Limité à ${d} résultats`:''),a.target.reportValidity()}))},preserveScroll(){window.addEventListener('beforeunload',()=>{sessionStorage.setItem('checkDataScroll',window.scrollY)});const a=sessionStorage.getItem('checkDataScroll');a&&(c(()=>{window.scrollTo(0,parseInt(a)),sessionStorage.removeItem('checkDataScroll')}))}}})();