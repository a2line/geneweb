<!-- $Id: modules/individu.txt v 7.00 07/05/2018 07:54:32 hg -->
%( options
0: skip
1: standard
2: centered
3: two columns
%)
%let;op_m;%if;(op_m!="")%op_m;%else;1%end;%in;

%define;link(xxx,zzz)
  %if;(not cancel_links)<a href="%prefix;m=zzz;v=%sq;
    %if;("xxx"=first_name)%first_name_key;%sq;
    %elseif;("xxx"=surname)%surname_key;%sq;
    %( how to get (first/sur)_name_alias_keys? %)
    %else;xxx%sq;
    %end;">%sq;
  %end;xxx%if;(not cancel_links)</a>%end;
%end;

%define;detailed_names()
  %if;(has_qualifiers or has_aliases or has_nobility_titles or
       has_public_name or has_surnames_aliases or has_first_names_aliases or
       has_linked_page.HEAD or computable_death_age or computable_age)
    %foreach;qualifier;
      %if;not is_first;
        %if;has_public_name;%public_name; %qualifier;
        %else;%first_name; %qualifier;%end;<br>
      %end;
    %end;
    %if;(has_public_name or has_qualifiers)
      <span class="font-weight-bold">%apply;link(first_name,"P") %apply;link(surname,"N")</span><br>
    %end;
    %if;has_aliases;
      Alias%sp;
      %apply;lazy_print("")
      %foreach;alias;
        %if;(lazy_printed)/%end;
        %lazy_force;
        <b>%alias;</b>%nn;
      %end;
      <br>
    %end;
    %if;has_nobility_titles;
      <em>%nn;
      %foreach;nobility_title;%nn;
       %if;not is_first;,%sp;%end;
        %nobility_title;%nn;
      %end;
      </em><br>
    %end;
    %if;(has_linked_page.HEAD and linked_page.HEAD!="")%linked_page.HEAD;<br>%end;
    %if;has_first_names_aliases;
      %apply;lazy_print("")
      %apply;link(first_name,"P")/%sq;
      %foreach;first_name_alias;
        %if;(lazy_printed)/%end;
        %lazy_force;
        %apply;link(first_name_alias,"P")
      %end;
      <br>
    %end;
    %if;has_surnames_aliases;
      %apply;lazy_print("")
      %apply;link(surname,"N")/%sq;
      %foreach;surname_alias;
        %if;(lazy_printed)/%end;
        %lazy_force;
        %apply;link(surname_alias,"N")
      %end;
      <br>
    %end;
  %end;
%end;
%define;half(xxx,yyy)
  %apply;capitalize(nth([xxx:::yyy],sex))
%end;
%define;cousin(l1,l2,dd)
  %if;([cousin.l1.l2:::dd]!="[cousin.l1.l2:::dd]")%apply;half("cousin.l1.l2","dd")%else;[*close family]0 (<small class="text-muted">l1/l2</small>)%end;
%end;
%define;ancestor(aaa,ccc,sss,ttt)
  %if;(cancel_links) aaa
  %else;
    <a href="%prefix;ccc"
      title="%apply;a_of_b%with;Sosa sss%and;%self;%end;&#013;
             %apply;a_of_b%with;Sosa ttt%and%sosa_ref;%end">aaa</a>%nn;
  %end;
%end;
%define;all_link()
  <a href="%prefix;em=R&et=S&ei=%index;&i=%sosa_ref.index;&dag=on"
%( autre possibilité %prefix;&m=NG&em=R&et=A&ei=%index;&select=%sosa_ref.index;&spouse=on&long=on" %)
    title="[*searching all] [relationship link/relationship links]1">
    <i class="fas fa-%if;(l1=0)child%else;user-friends%end;"></i></a>
%end;
%define;setvar(nnn,vvv)
  %set_var.nnn.vvv;
%end;
%define;getvar(nnn)
  %get_var.nnn;
%end;
%define;from_sosa()
  %if;(browsing_with_sosa_ref and has_parents and not has_sosa)
    %reset_count;%reset_count1;
    %foreach;ancestor_level;
      %incr_count1;
      %if;(count < 2 and level <= 15)
        %foreach;ancestor;
          %if;(ancestor.has_sosa and ancestor.anc_sosa.v < 16385)
            %if;(count = 0)
              %incr_count;
              %apply;setvar(l1,ancestor.sosa.lvl-1)
              %apply;setvar(l2,count1-1)
              %apply;setvar(ancestor1_anc_sosa,ancestor.anc_sosa.v)
              %apply;setvar(ancestor1_sosa_cujus,ancestor.sosa.v)
              %apply;setvar(ancestor1_index,ancestor.index)
              %apply;setvar(ancestor1_access,ancestor.access)
              %apply;setvar(ancestor1,ancestor)
            %elseif;(count = 1)
              %let;a1s;%apply;getvar(ancestor1_anc_sosa)%in;
              %let;a1sc;%apply;getvar(ancestor1_sosa_cujus)%in;
              %if;(a1s %2 = 0 and ancestor.anc_sosa.v-a1s = 1
                and a1sc %2 = 0 and ancestor.sosa.v-a1sc = 1)
                %incr_count;
                %apply;setvar(ancestor2_anc_sosa,ancestor.anc_sosa.v)
                %apply;setvar(ancestor2_sosa_cujus,ancestor.sosa.v)
                %apply;setvar(ancestor2_access,ancestor.access)
                %apply;setvar(ancestor2,ancestor)
              %else;%incr_count;%incr_count;
              %end;
            %end;
          %end;
        %end;
      %end;
    %end;
    %let;l1;%apply;getvar(l1)%in;
    %let;l2;%apply;getvar(l2)%in;
    %if;(count>0)
      <li class="mt-2"><span class="fa-li">%apply;all_link()</span>
        %apply;a_of_b%with;
          <a href="%prefix;m=RL&i=%apply;getvar(ancestor1_index)&i1=%sosa_ref.index;&l1=%l1;&i2=%index;&l2=%l2;&spouse=on&dag=on"
            title="[*to see the first relationship link]%sp;
              [relationship link/relationship links]0,
              [degree of kinship] %expr(l1+l2) (%l1;/%l2;)">%nn;
            %apply;cousin%with;%l1;%and;%l2;%and;%if;(count=3 and l1!=0)½-%end;%end;</a>
        %and;
          <a href="%prefix;%sosa_ref.access;"
            title="[Sosa 1]">%sosa_ref;</a>%nn;
        %end;
        %if;(l1!=0)%sp;[passing by]
          %apply;ancestor%with;%apply;getvar(ancestor1)
                               %and;%apply;getvar(ancestor1_access)
                               %and;%apply;getvar(ancestor1_anc_sosa)
                               %and;%apply;getvar(ancestor1_sosa_cujus)%end;
        %end;
        %if;(count=2) [and]
          %apply;ancestor%with;%apply;getvar(ancestor2)
                               %and;%apply;getvar(ancestor2_access)
                               %and;%apply;getvar(ancestor2_anc_sosa)
                               %and;%apply;getvar(ancestor2_sosa_cujus)%end;
        %end;
      </li>
    %end;
  %end;
%end;
%define;etat_civil()
  <ul class="fa-ul">
    %if;(has_birth_date or has_birth_place)
      <li><span class="fa-li"><i class="fas fa-baby"></i></span>
        %if;has_birth_date;
          %apply;capitalize(nth([born],sex)) %on_birth_date;
          %if;birthday; ([happy birthday to you!])%end;
          %if;has_birth_place; - %birth_place;%end;
        %else;
          %if;has_birth_place;
            %apply;capitalize(nth([born],sex)) - %birth_place;
          %end;
        %end;
      </li>%nl;
    %end;
    %if;(has_baptism_date or has_baptism_place)
      <li>
        <span class="fa-li"><i class="fas fa-dove"></i></span>
        %if;has_baptism_date;
          %apply;capitalize(nth([baptized],sex)) %on_baptism_date;
            %if;has_baptism_place; - %baptism_place;%end;
        %else;
          %if;has_baptism_place;
            %apply;capitalize(nth([baptized],sex)) - %baptism_place;
          %end;
        %end;
      </li>%nl;
    %end;
    %if;is_dead;
      <li class="mt-1"><span class="fa-li"><i class="fas fa-skull-crossbones"></i></span>
        %apply;capitalize(died)
        %if;has_death_date; %on_death_date;%end;
        %if;has_death_place; - %death_place;%end;
        %if;(has_linked_page.DEATH and linked_page.DEATH!="") (%linked_page.DEATH;)%end;</li>%nl;
    %end;
    %if;(is_buried or is_cremated)
      <li><span class="fa-li"><i class="fas fa-cross"></i></span>
        %if;is_buried;
          %apply;capitalize(nth([buried],sex))
          %if;has_burial_date; %on_burial_date;%end;
          %if;has_burial_place; - %burial_place;%end;</li>%nl;
        %end;
        %if;is_cremated;
          %apply;capitalize(nth([cremated],sex))
          %if;has_cremation_date; %on_cremation_date;%end;
          %if;has_cremation_place; - %cremation_place;%end;</li>%nl;
        %end;
      </li>%nl;
    %end;
    %if;(computable_death_age or computable_age)
      <li class="mt-1"><span class="fa-li"><i class="far fa-id-card"></i></span>
        %if;(is_dead and computable_death_age)%death_age%end;
        %if;(not is_dead and computable_age)%age;%end;
      </li>
    %end;
    %if;has_occupation;
      <li class="mt-1"><span class="fa-li"><i class="fas fa-user-tie"></i></span>
        %apply;capitalize(occupation)</li>%nl;
    %end;
    %if;(has_linked_page.OCCU and linked_page.OCCU!="")
      <li>%apply;capitalize(linked_page.OCCU)</li>%nl;
    %end;
    %if;(has_consanguinity and bvar.show_consang!="no")
      <li class="mt-1"><span class="fa-li"><i class="fas fa-percentage"></i></span>
        %if;(cancel_links)
          [*consanguinity][:] %consanguinity;
        %else;
          <a href="%prefix;m=NG;em=R;et=A;ei=%mother.index;;select=%father.index;;spouse=on%if;(evar.image!="");image=%evar.image;%end;"
             title="[*relationship computing] [father/mother]0/[father/mother]1">[*consanguinity][:] %consanguinity;
        %end;
      </li>%nl;
    %end;
    %if;not cancel_links;
      %apply;from_sosa()
      %apply;sosa()
    %end;
  </ul>
%end;
%define;portrait()
  %if;(has_image or bvar.default_image="yes")
    <div class="d-flex align-items-center">
      %if;has_image;
        %if;(evar.cgl!="on") 
          <a href="%image_url;" target="_blank">
            <img src="%image_url;"%image_size; class=" %if;(op_m=3)align-self-center mx-1%end; rounded" alt="[image/images]0"%/>%nn;
          </a>%nn;
        %else;
          <img src="%image_url;"%image_size; class="%if;(op_m=3)align-self-center mx-1%end; rounded" alt="[image/images]0"%/>%nn;
        %end;
      %elseif;(bvar.default_image="yes")
        <img class="%if;(op_m=3)d-flex align-self-center mx-1%end; rounded" src="%image_prefix;/img_unknown_%if;(is_female)wo%elseif;(is_male)%else;u_%end;man.png"%image_size; alt="[missing image]"%/>
      %end;
    </div>
  %end;
%end;
%define;nthgen(xxx)
  %apply;nth([nth (generation)], xxx) [generation/generations]0%nn;
%end;
%define;sosa()
  %reset_count;
  %if;(has_sosa and not cancel_links)
    <li class="mt-1"><span class="fa-li"><i class="far fa-dot-circle text-success"></i></span>
      %if;(sosa=1)[*Sosa 1]
      %else;
        %apply;a_of_b%with;<a href="%prefix;%sosa_link;">[Sosa] %sosa; – %nn;
          %if;(sosa.lvl=2)
            %apply;capitalize(nth([the father/the mother/a parent],sex))
          %elseif;(sosa.lvl=3)
            %apply;capitalize(nth([a grandfather/a grandmother/a grandparent],sex))
          %elseif;(sosa.lvl=4)
            %apply;capitalize(nth([a great-grandfather/a great-grandmother/a great-grandparent],sex))
          %elseif;(sosa.lvl<10)
            %apply;cousin%with;%expr(sosa.lvl-1)%and;0%and;%end;%nn;
          %else;%apply;capitalize(nth([an ancestor],sex))
          %end;
          </a>
        %and;
          %if;(sosa_ref.is_restricted)%sosa_ref;%else;<a href="%prefix;%sosa_ref.access;" title="[Sosa 1]">%sosa_ref;</a>%end;%nn;
          %if;(sosa.lvl>9)(%apply;nthgen%with;%sosa.lvl;%end;)%end;
        %end;
      %end;
    </li>
  %end;
%end;

%define;border()
  <div class="w-50 border border-dark border-left-0 border-top-0 border-bottom-0">&#8203;</div>
%end;

%let;evm;%if;(evar.m="F")m=F;%end;%in;
%let;prefx;%if;(evar.m="F")%prefix_no_pmod;%else;%prefix;%end;%in;
%if;(evar.m!="MOD_IND")
  <div class="col-12">
  <h1 class="%if;(op_m=2)text-center%else;text-xs-center text-md-left%end;">
    %if;has_public_name;
      %if;has_qualifiers;%public_name; <em>%qualifier;</em>
      %else;%public_name; %surname;%end;
    %else;
      %if;has_qualifiers;%first_name; <em>%qualifier;</em>
      %else;
        %if;cancel_links;%first_name; %surname;
        %else;
          <a href="%prefix;m=P;v=%first_name_key;#i%index;">%first_name;</a>
          <a href="%prefix;m=N;v=%surname_key;#i%index;">%surname;</a>
        %end;
      %end;
    %end;
    <span class="font-weight-light small">%dates;</span>
  </h1>
  </div> %( closing div just before h1 %)

  %if;((p_mod="zz" or p_mod="") and evar.m!="F")
    <div class="col-12%if;(evar.wide!="on") col-lg-8%end;">
  %end;
  %if;(op_m=1)
    %apply;portrait()
    %apply;etat_civil()
    <div class="mt-2 mb-1 ml-2">
      %apply;detailed_names()
    </div>
  
  %elseif;(op_m=2)
    <div class="col-12 text-center mb-2 mx-2">
      %apply;portrait()
    </div>
    <div class="col-12 text-center mb-2 mx-2">
      %apply;detailed_names()
    </div>
    %apply;etat_civil()
  
  %elseif;(op_m=3)
    <div class="d-flex">
      %apply;portrait()
      <div>
        <div class="text-center mb-2 mx-2">
          %apply;detailed_names()
        </div>
        %apply;etat_civil()
      </div>
    </div>
  %else;
  Unavailable option value!
  %end;
%end;
