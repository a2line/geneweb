<!-- Id: js_perso.txt -->
%(
  This is a template file for customizing GeneWeb's JavaScript functionality.
  To use it:
  1. Make sure js_perso="yes" is set in your GeneWeb .gwf configuration file
  2. Edit this or copy it to your GeneWeb "bases/etc/mybase" directory,
     like it's can be done for header and trailer custom files.
  3. Modify it according to your needs

  Two main ways to add custom JavaScript:
  1. Direct code that runs immediately
  2. Code that waits for page load using runAfterPageLoad()
%)
%if;(("MOD_IND" in e.m) or (e.m="NOTES" and "RESULT" in e.f) or (e.m="S" and e.edit=1))
    // Load the InseeTools script and initialize the appropriate module
    runAfterPageLoad(() => {
          const shouldLoadInseeTools = (() => {
              if (window.location.href.includes('f=RESULT') || 
                  window.location.href.includes('edit=1')) {
                  return true;
              }
              if (document.querySelector('form[id="updind"]')) {
                  const selfElement = document.querySelector('#self[data-key]');
                  const key = selfElement?.getAttribute('data-key') || '';
                  const data = localStorage.getItem(key);
                  return data !== null;
              }
              return false;
          })();
          if (shouldLoadInseeTools) {
              const script = document.createElement('script');
              script.src = "%etc_prefix;js/inseert.js?" + Date.now();
              script.onload = () => {
                  // Initialize the appropriate module based on the current page
                  if (window.location.href.includes('f=RESULT')) {
                      InseeTools.results.init();
                  } else if (window.location.href.includes('edit=1')) {
                      InseeTools.individual.init();
                  } else if (document.querySelector('form[id="updind"]')) {
                      InseeTools.form.init();
                  }
              };
              document.body.appendChild(script);
          }
    });
%end;