<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wserver (geneweb.Wserver)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">geneweb</a> &#x00BB; Wserver</nav><header class="odoc-preamble"><h1>Module <code><span>Wserver</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-handler"><a href="#type-handler" class="anchor"></a><code><span><span class="keyword">type</span> handler</span><span> =
  <span><span>(<span class="xref-unresolved">Unix</span>.sockaddr * <span>string list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Adef/index.html#type-encoded_string">Adef.encoded_string</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : 
  <span><span class="optlabel">?addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timeout</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">max_pending_requests</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">n_workers</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-handler">handler</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>Wserver.start ~secret_salt ?addr ~port ?timeout ~n_workers callback</code> starts a HTTP 1.1 server that listens on the address <code>addr</code> and port <code>port</code>.</p><p>On Unix, worker jobs managed by <code>n_workers</code> workers have a time limit of <code>timeout</code>. If <code>timeout</code> is <code>0</code>, there is no limit. This is the default.</p><p>The <code>max_pending_requests</code> argument specified the maximum number of pending requests that the server can store. If the queue is full, new requests are ignored until space becomes available.</p><p>When a client connects, <code>callback</code> is invoked with the arguments <code>(addr, request) path query</code> where:</p><ul><li><code>addr</code> is the client address,</li><li><code>request</code> is the client request,</li><li><code>path</code> is the path of the request,</li><li><code>query</code> is the query content.</li></ul><p>Listening on ports &lt; 1024 may require root privileges.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_connection"><a href="#val-close_connection" class="anchor"></a><code><span><span class="keyword">val</span> close_connection : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Closes the current socket</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-printf"><a href="#val-printf" class="anchor"></a><code><span><span class="keyword">val</span> printf : <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.out_channel, unit)</span> <span class="xref-unresolved">Stdlib</span>.format</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Formatter printing in the out channel associated to the connected socket</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-print_string"><a href="#val-print_string" class="anchor"></a><code><span><span class="keyword">val</span> print_string : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Prints a string in the out channel associated to the socket</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-header"><a href="#val-header" class="anchor"></a><code><span><span class="keyword">val</span> header : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Prints a header; cannot be called if part of content part already has been sent</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wflush"><a href="#val-wflush" class="anchor"></a><code><span><span class="keyword">val</span> wflush : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Flushes the content of the current socket</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_status"><a href="#val-string_of_status" class="anchor"></a><code><span><span class="keyword">val</span> string_of_status : <span><a href="../Def/index.html#type-httpStatus">Def.httpStatus</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>HTTP status line (e.g. &quot;200 OK&quot;, &quot;404 Not Found&quot;).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-http"><a href="#val-http" class="anchor"></a><code><span><span class="keyword">val</span> http : <span><a href="../Def/index.html#type-httpStatus">Def.httpStatus</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Output.status conf answer</code> sends the http header where <code>answer</code> represents the answer status.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-http_redirect_temporarily"><a href="#val-http_redirect_temporarily" class="anchor"></a><code><span><span class="keyword">val</span> http_redirect_temporarily : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Output.status conf_redirect url</code> sends the http header where <code>url</code> represents the Location where the request needs to be redirected.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_request_and_content"><a href="#val-get_request_and_content" class="anchor"></a><code><span><span class="keyword">val</span> get_request_and_content : 
  <span><span>char <span class="xref-unresolved">Stream</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string list</span> * <a href="../Adef/index.html#type-encoded_string">Adef.encoded_string</a></span></code></div><div class="spec-doc"><p>Returns the request from a stream read from a socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wsocket"><a href="#val-wsocket" class="anchor"></a><code><span><span class="keyword">val</span> wsocket : <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></div><div class="spec-doc"><p>Returns the last used socket</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-woc"><a href="#val-woc" class="anchor"></a><code><span><span class="keyword">val</span> woc : <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.out_channel</span></code></div><div class="spec-doc"><p>Return the out_channel associated to the socket</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sock_in"><a href="#val-sock_in" class="anchor"></a><code><span><span class="keyword">val</span> sock_in : <span>string <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Names of the files used in windows implementation to communicate http requests and html answers. Default &quot;wserver.sin&quot; and &quot;wserver.sou&quot;. Can have relative or absolute paths.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sock_out"><a href="#val-sock_out" class="anchor"></a><code><span><span class="keyword">val</span> sock_out : <span>string <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stop_server"><a href="#val-stop_server" class="anchor"></a><code><span><span class="keyword">val</span> stop_server : <span>string <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>Name of the file whose presence tells the server to stop (at least one request is necessary to unfreeze the server to make it check that this file exits. Default &quot;STOP_SERVER&quot;. Can have relative or absolute path.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cgi"><a href="#val-cgi" class="anchor"></a><code><span><span class="keyword">val</span> cgi : <span>bool <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div><div class="spec-doc"><p>CGI (Common Gateway Interface) mode (default false).</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Pool"><a href="#module-Pool" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Pool/index.html">Pool</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="Pool/index.html">Pool</a></span></code></div></div></div></body></html>
