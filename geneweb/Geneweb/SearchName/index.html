<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>SearchName (geneweb.Geneweb.SearchName)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">geneweb</a> &#x00BB; <a href="../index.html">Geneweb</a> &#x00BB; SearchName</nav><header class="odoc-preamble"><h1>Module <code><span>Geneweb.SearchName</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-search_case"><a href="#type-search_case" class="anchor"></a><code><span><span class="keyword">type</span> search_case</span><span> = </span></code><ol><li id="type-search_case.NoInput" class="def variant constructor anchored"><a href="#type-search_case.NoInput" class="anchor"></a><code><span>| </span><span><span class="constructor">NoInput</span></span></code></li><li id="type-search_case.PersonName" class="def variant constructor anchored"><a href="#type-search_case.PersonName" class="anchor"></a><code><span>| </span><span><span class="constructor">PersonName</span> <span class="keyword">of</span> string</span></code></li><li id="type-search_case.SurnameOnly" class="def variant constructor anchored"><a href="#type-search_case.SurnameOnly" class="anchor"></a><code><span>| </span><span><span class="constructor">SurnameOnly</span> <span class="keyword">of</span> string</span></code></li><li id="type-search_case.FirstNameOnly" class="def variant constructor anchored"><a href="#type-search_case.FirstNameOnly" class="anchor"></a><code><span>| </span><span><span class="constructor">FirstNameOnly</span> <span class="keyword">of</span> string</span></code></li><li id="type-search_case.FirstNameSurname" class="def variant constructor anchored"><a href="#type-search_case.FirstNameSurname" class="anchor"></a><code><span>| </span><span><span class="constructor">FirstNameSurname</span> <span class="keyword">of</span> string * string</span></code></li><li id="type-search_case.ParsedName" class="def variant constructor anchored"><a href="#type-search_case.ParsedName" class="anchor"></a><code><span>| </span><span><span class="constructor">ParsedName</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-search_case.first_name" class="def record field anchored"><a href="#type-search_case.first_name" class="anchor"></a><code><span>first_name : <span>string option</span>;</span></code></li><li id="type-search_case.surname" class="def record field anchored"><a href="#type-search_case.surname" class="anchor"></a><code><span>surname : <span>string option</span>;</span></code></li><li id="type-search_case.oc" class="def record field anchored"><a href="#type-search_case.oc" class="anchor"></a><code><span>oc : <span>string option</span>;</span></code></li><li id="type-search_case.original" class="def record field anchored"><a href="#type-search_case.original" class="anchor"></a><code><span>original : string;</span></code></li><li id="type-search_case.format" class="def record field anchored"><a href="#type-search_case.format" class="anchor"></a><code><span>format : <span>[ `Space <span>| `Slash</span> <span>| `Dot</span> <span>| `SlashSurname</span> <span>| `SlashFirstName</span> <span>| `DotOc</span> ]</span>;</span></code></li></ol><code><span>}</span></code></li><li id="type-search_case.InvalidFormat" class="def variant constructor anchored"><a href="#type-search_case.InvalidFormat" class="anchor"></a><code><span>| </span><span><span class="constructor">InvalidFormat</span> <span class="keyword">of</span> string</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-name_components"><a href="#type-name_components" class="anchor"></a><code><span><span class="keyword">type</span> name_components</span><span> = </span><span>{</span></code><ol><li id="type-name_components.first_name" class="def record field anchored"><a href="#type-name_components.first_name" class="anchor"></a><code><span>first_name : <span>string option</span>;</span></code></li><li id="type-name_components.surname" class="def record field anchored"><a href="#type-name_components.surname" class="anchor"></a><code><span>surname : <span>string option</span>;</span></code></li><li id="type-name_components.oc" class="def record field anchored"><a href="#type-name_components.oc" class="anchor"></a><code><span>oc : <span>string option</span>;</span></code></li><li id="type-name_components.person_name" class="def record field anchored"><a href="#type-name_components.person_name" class="anchor"></a><code><span>person_name : <span>string option</span>;</span></code></li><li id="type-name_components.case" class="def record field anchored"><a href="#type-name_components.case" class="anchor"></a><code><span>case : <a href="#type-search_case">search_case</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extract_name_components"><a href="#val-extract_name_components" class="anchor"></a><code><span><span class="keyword">val</span> extract_name_components : <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-name_components">name_components</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-search_key_aux"><a href="#val-search_key_aux" class="anchor"></a><code><span><span class="keyword">val</span> search_key_aux : 
  <span><span>(<span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
    <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span> <span class="arrow">&#45;&gt;</span></span>
    <span>string <span class="arrow">&#45;&gt;</span></span>
    <span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span></span></code></div><div class="spec-doc"><p><code>search_key_aux aux conf base str</code> searches persons by misc name <code>str</code> (which could be one of the aliases or misc names). If result is empty, tries to search names with roman numerals converted from arabic numbers (if present in the name). Applies <code>aux</code> on the result and removes all duplicates.</p><p>Empty persons, persons with private names, or persons to which there are no access rights are filtered out.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">aux</span> <p>Function to filter and process the intermediate result list</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conf</span> <p>Base configuration</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">base</span> <p>Genealogical database</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">str</span> <p>Name string to search</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>List of matching persons (deduplicated)</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-search_by_name"><a href="#val-search_by_name" class="anchor"></a><code><span><span class="keyword">val</span> search_by_name : 
  <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span></span></code></div><div class="spec-doc"><p><code>search_by_name conf base name</code> searches persons by name in the format <code>&quot;firstname surname&quot;</code> (space-separated, last space is the separator).</p><p>The search uses the surname index to find bearers of the surname, then filters by first name matching.</p><p>Duplicates are possible (different occurrences with same name). Empty persons, persons with private names, or persons to which there are no access rights are filtered out.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conf</span> <p>Base configuration</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">base</span> <p>Genealogical database</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">name</span> <p>Name string in format &quot;firstname surname&quot;</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>List of matching persons</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-search_by_sosa"><a href="#val-search_by_sosa" class="anchor"></a><code><span><span class="keyword">val</span> search_by_sosa : 
  <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> option</span></span></code></div><div class="spec-doc"><p><code>search_by_sosa conf base sosa_str</code> searches a person using their Sosa-Stradonitz ancestor number.</p><p>This requires that a Sosa reference person (Sosa 1) has been defined in the base configuration.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conf</span> <p>Base configuration (must have sosa_ref defined)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">base</span> <p>Genealogical database</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">sosa_str</span> <p>String representation of the Sosa number</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Some person</code> if found and Sosa reference exists, <code>None</code> otherwise</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-search_by_key"><a href="#val-search_by_key" class="anchor"></a><code><span><span class="keyword">val</span> search_by_key : 
  <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> option</span></span></code></div><div class="spec-doc"><p><code>search_by_key conf base key</code> searches by unique person key in the format <code>&quot;firstname.occ surname&quot;</code> where <code>occ</code> is the occurrence number.</p><p>Only one person may match such a format (keys are unique identifiers).</p><p>Example: <code>&quot;Jean.2 DUPONT&quot;</code> searches for the second occurrence of Jean DUPONT.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conf</span> <p>Base configuration</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">base</span> <p>Genealogical database</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">key</span> <p>Key string in format &quot;firstname.occ surname&quot;</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Some person</code> if exactly one person matches, <code>None</code> otherwise</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-search_approx_key"><a href="#val-search_approx_key" class="anchor"></a><code><span><span class="keyword">val</span> search_approx_key : 
  <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span></span></code></div><div class="spec-doc"><p><code>search_approx_key conf base key</code> searches by approximate key matching.</p><p>Calls <a href="#val-search_key_aux"><code>search_key_aux</code></a> with a filter function that only keeps persons whose concatenated first name and surname (<code>firstname ^ surname</code>) or one of their misc names/aliases equals the search key.</p><p>This is more flexible than <a href="#val-search_by_key"><code>search_by_key</code></a> as it:</p><ul><li>Doesn't require the occurrence number</li><li>Matches against aliases</li><li>Returns multiple matches if they exist</li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conf</span> <p>Base configuration</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">base</span> <p>Genealogical database</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">key</span> <p>Approximate key string</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>List of matching persons</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-print"><a href="#val-print" class="anchor"></a><code><span><span class="keyword">val</span> print : 
  <span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Config/index.html#type-config">Config.config</a> <span class="arrow">&#45;&gt;</span></span>
    <span><a href="../../Geneweb_db/Driver/index.html#type-base">Geneweb_db.Driver.base</a> <span class="arrow">&#45;&gt;</span></span>
    <span>string <span class="arrow">&#45;&gt;</span></span>
    <span><span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><a href="../../Geneweb_db/Driver/index.html#type-person">Geneweb_db.Driver.person</a> list</span> <span class="arrow">&#45;&gt;</span></span>
    unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>print conf base specify</code> is the main search entry point.</p><p>Analyzes request parameters (<code>&amp;p</code>, <code>&amp;n</code>, <code>&amp;pn</code>) and dispatches to appropriate search strategies.</p><p><b>Search parameter formats:</b></p><ul><li><code>&amp;p=firstname</code>: First name only search</li><li><code>&amp;n=surname</code>: Surname only search</li><li><code>&amp;p=fn&amp;n=sn</code>: Combined first name and surname search</li><li><code>&amp;pn=name</code>: Parsed name with multiple formats:</li><li><code>&quot;fn sn&quot;</code>: Space-separated (last space = separator)</li><li><code>&quot;fn/sn&quot;</code>: Slash-separated</li><li><code>&quot;fn.sn&quot;</code>: Dot-separated</li><li><code>&quot;fn.oc sn&quot;</code>: Dot-separated with occurrence number</li><li><code>&quot;/sn&quot;</code>: Surname only (slash prefix)</li><li><code>&quot;fn/&quot;</code>: First name only (slash suffix)</li></ul><p><b>Search methods executed in order:</b></p><ol><li>Sosa: Sosa-Stradonitz ancestor number</li><li>Key: Unique person key (FirstName.Occ SURNAME)</li><li>FullName: Combined first name + surname (exact then fuzzy)</li><li>ApproxKey: Approximate key matching (handles aliases)</li><li>PartialKey: Partial name matching</li><li>Surname: Surname search (exact then phonetic)</li><li>FirstName: First name search with options</li></ol><p><b>Search options:</b></p><p>Options <code>&amp;p_order</code>, <code>&amp;p_exact</code> only apply to first name searches (<code>&amp;p</code> and <code>&amp;pn</code> with first name component). See <code>opts</code> for details.</p><p><b>Result handling:</b></p><ul><li>Single exact match: Display person directly (calls <code>Perso.print</code>)</li><li>Multiple exact matches: Call <code>specify</code> callback to disambiguate</li><li>No matches: Display welcome page</li><li>Mixed results: Separate by category (exact/partial/spouse)</li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conf</span> <p>Base configuration and request parameters</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">base</span> <p>Genealogical database</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">specify</span> <p>Callback for displaying multiple match disambiguation, receives: conf, base, query, exact_list, partial_list, spouse_list</p></li></ul></div></div></div></body></html>
