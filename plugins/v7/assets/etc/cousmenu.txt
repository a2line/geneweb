<!DOCTYPE html>
<html lang="%lang;">
<head>
  <!-- $Id: cousmenu.txt,v 7.0 20/09/2021 21:28:24 ddr a2 Exp $ -->
  <!-- Copyright (c) 1998-2022 INRIA -->
  <title>%nn;
    %apply;a_of_b_gr_eq_lev%with;
      [*cousins (general term)]%nn;
    %and;
      %if;(public_name != "")%public_name;%else;%first_name;%end;
      %if;(qualifier != "") %qualifier;%end;
      %sp;%surname;
    %end;
  </title>
  <meta name="robots" content="none">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="%image_prefix;/favicon_gwd.png">
  %include;favicon
  %include;css
  %include;hed
</head>
<body%body_prop;>
%message_to_wizard;
<div class="container%if;(evar.v!="" and evar.v>5)-fluid%end;">
%include;perso_utils
%include;menubar
%define;picklvl(vvv)
  <a role="button" class="btn btn-primary btn-sm my-3 %if;((evar.v="" and vvv=3) or (evar.v!="" and evar.v=vvv)) disabled%end; align-self-center" href="%prefix_base_password;%foreach;env_binding;%if;(env.val!="" and env.key!="v")&%env.key=%env.val;%end;%end;%if;(vvv!=3)&v=%expr(vvv)%end;" title="[*maximum degre of ascendant parentship]">vvv</a>
%end;
<div class="d-flex justify-content-between">
  <h1>%nn;
    [*link between]%sp;
    %if;(public_name != "")%public_name;%else;%first_name;%end;
    %if;(qualifier != "") <em>%qualifier;</em>%end;
    %sp;%surname;
    %(%if;(alias != "") <em>(%alias;)</em>%end;%)
    %sp;[and] [close family]
  </h1>
  <div class="ml-auto py-0 btn-group%if;(evar.v!="" and evar.v>3) mr-4%end;" role="group" aria-label="gen. pick">
    %let;min;%if;(not has_children)1%else;0%end;%in;
    %let;max;%if;(static_max_anc_level>bvar.max_anc_level and bvar.max_anc_level<10)%bvar.max_anc_level;%elseif;(static_max_anc_level<10)%static_max_anc_level%else;10%end;%in;
    %for;i;min;max;%apply;picklvl(i)%end;
  </div>
</div>
%define;nth_cousins(xx)
  [*%s cousins:::xx]%nn;
%end;
%define;cousin_lex(vvv,www)
  [cousin.vvv.www]1
%end;
%define;cousin_lex_tt(vvv,www)
  %( condition pour garder la tooltip (title="") vide si elle n'est pas définie pour la langue en cours %)
  %if;([cousin.vvv.www tt]!="[cousin.vvv.www tt]")[cousin.vvv.www tt]1%else;%end;
%end;
%define;list_ancestor(vvv)
  %foreach;ancestor_level;
    %if;(level=vvv+1)
      %foreach;ancestor;
        %if;(is_first)<span class="text-nowrap">%nn;
        %else;
          %if;(ancestor.is_male)</span> <span class="text-nowrap">%end;
        %end;
        %if;(ancestor.is_female and not is_first) & %end;%ancestor;%nn;
        %if;(not is_last)%if;(ancestor.is_female) · %end;
          %else;</span>
        %end;
      %end;
    %end;
  %end;
%end;
%define;link(vvv,lll,ttt,ddd)
 %let;width;%expr((100/(evar.v+1))*vvv)%in;
 %if("ddd"="disabled" and vvv!=0)
 %else;
   <td%if;(vvv>0) colspan="%expr(vvv+1)"%end; %if;(vvv=0)style="width:%expr(100/lll)%%"%end; class="table-%if;(vvv=0)info%elseif;(vvv %2 = 1)primary%else;danger%end;" >
     <div class="%if;(vvv>=0)border-right %(border-bottom %)border-%if;(i=0)success%elseif;(vvv%2=1)primary%else;danger%end;%end;  d-flex flex-column   justify-content-between">
       <div class="font-weight-bold" style="height:%;"><sup>vvv</sup>/<sub>0</sub></div>
       <a role="button" href="%prefix_base_password;&%access;&m=C&v1=vvv&v2=0" 
        class="btn btn-light ddd w-100"%if;(vvv<5) style="height:120px;"%end;
         data-toggle="tooltip" data-html="true" title="%apply;cousin_lex_tt(vvv,0)">
         %if;(vvv=0)<span class="badge badge-success">1</span><br>%end;ttt%nn;
         %if;(vvv<10)<div class="d-flex justify-content-center"><div class="mt-1 small text-muted col-11">%apply;list_ancestor(vvv)</div></div></a>%end;
      <div>%expr(100/.(2^vvv)) %%</div>
      </div>
    </td>
  %end;
%end;
%define;one_ancestor(vvv,ttt)
  %reset_count;
    %foreach;ancestor_level;
      %if;(level=vvv+1)
        %foreach;ancestor;
          %incr_count;
        %end;
      %end;
    %end;
  %apply;link%with;vvv%and;%and;<span class="badge badge-xl badge-%if;(vvv %2 = 1)primary%else;danger%end;"> %count;</span><br>ttt%and;%if;(count=0)disabled%end;%end;
%end;
%( Calcul de la hauteur maximale du tableau descendant, limité en dur à deux fois max la hauteur montante evar.v %)
%let;maxv;%if;(evar.v="")4%else;%expr(evar.v+1)%end;%in;
%let;maxw;%if;(evar.v=0 or (2*maxv<static_max_desc_level+1 and static_max_desc_level<10))%expr(static_max_desc_level+2)%else;%expr(2*maxv)%end;%in;
%let;minw;%if;has_children;2%else;1%end;%in;
%define;cous(vvv,www)
  %cousins.vvv.www;
%end;
%define;row_counts(xxx)
  %for;i;0;maxv;
    %apply;cous%with;%expr(i)%and;%expr(i+xxx)%end;
  %end;
%end;
%reset_count;
%for;i;minw;maxw;
  %let;row_xxx;%apply;row_counts(i)%in;
  %if;(row_xxx<=0)%incr_count;%end;
%end;
%let;maxdesc;%expr(maxw-count)%in;
%define;link_cousin(vvv,www,ttt,sss)
  %let;cousin_vvv_www;%if;("v7" in bvar.plugins)%cousins.vvv.www;%end;%in;
  <a role="button" href="%prefix_base_password;%access;&m=C&v1=vvv&v2=www" data-toggle="tooltip" data-html="true" title="sss" class="btn btn-light %if;(cousin_vvv_www!="" and cousin_vvv_www=0) disabled%end; w-100" %if;(www-vvv<=10) style="height:120px;"%end;>
    %if;("v7" in bvar.plugins)
      <span class="badge badge-%if;(vvv=0)info%elseif;(vvv%2=1)primary%else;danger%end;">
      %if;(cousin_vvv_www>bvar.max_cousins)
        <span class="text-danger" title="max %bvar.max_cousins;">≥%bvar.max_cousins;</span>
      %else;%cousin_vvv_www;
      %end;</span></br>
    %end;
    ttt</a><div>%if;(vvv=0)%expr((100/.(2^(vvv+www))))%else;%expr((100/.(2^(vvv+www-1))))%end; %%</div>
%end;
%( table of cousins.i.j-xxx+i, maxdesc calculé auparavant %)
%define;table(xxx)
  <table id="quickrel" class="table table-bordered table-responsive-sm text-center mb-0">
    %for;j;0;15;
      %if;(j>0 and j<xxx+maxdesc)
        <tr>
          %for;i;0;xxx;
            %if;(i!=0 and j+i=xxx)
              %apply;one_ancestor%with;%i%and;%apply;cousin_lex(i,0)%end;
            %elseif;(j+i<xxx)
              %(%if;(i!=0)
                <td class="border-0"></td>
              %end;%)
            %else;
               %if;(i=0 and j=xxx)
                 %apply;link%with;0%and;j%and;
                 <b>%if;is_male;[him/her]0%elseif;is_female;[him/her]1%end;</b>%nn;
                 %and;disabled%end;
               %else;
                 <td %if;(j=xxx)style="width:%expr(100/xxx)%%"%end; class="table-%if;(i=0)info%elseif;(i %2 = 1)primary%else;danger%end;">
                   <div class="%if;(i>=0)border-right %(border-bottom %)border-%if;(i=0)success%elseif;(i%2=1)primary%else;danger%end;%end; d-flex flex-column justify-content-between">
                     <span class="font-weight-bold"><sup>%i;</sup>/<sub>%expr(j-xxx+i)</sub></span>
%( TODO : traiter le cas neveux4 et petit-neveux4 %)
                     %apply;link_cousin%with;%i;%and;%expr(j-xxx+i)
                       %and;%apply;cousin_lex(i,j-xxx+i)
                       %and;%apply;cousin_lex_tt(i,j-xxx+i)
                     %end;
                   </div>
                 </td>
               %end;
            %end;
          %end;
        </tr>
      %end;
    %end;
    <tr>
      <td colspan="%xxx;">Descendants of only one ancestor are included in counts (half-siblings/half-cousins&hellip;)<br>%% moyen de gène en commun en fonction du lien de parenté<br>Shared DNA %% is divided by two for “half-relations”: full siblings 50 %% > half-siblings 25 %%</td>
    </tr>
  </table>
%end;
%if;(evar.v="")
  %apply;table(4)
%elseif(evar.v>0 or evar.v<10)
  %apply;table(evar.v+1)
%end;
%include;trl
%include;copyr
</div>
%include;js
<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>
</body>
</html>
